.\"t
.\" Automatically generated by Pandoc 2.5
.\"
.TH "SOCKET" "2" "" "Version 0.67" "SSA Daemon Documentation"
.hy
.SH NAME
.PP
socket \- create an endpoint for TLS\-secured communication
.SH SYNOPSIS
.PP
\f[B]#include <sys/types.h>\f[R]
.PD 0
.P
.PD
\f[B]#include <sys/socket.h>\f[R]
.PD 0
.P
.PD
\f[B]#include <in_tls.h>\f[R]
.PP
\f[B]int socket(int domain, int type, int protocol);\f[R]
.SH DESCRIPTION
.PP
\f[B]socket()\f[R] creates a local endpoint for communication, along
with an endpoint in the SSA Daemon mirroring the attributes of the local
endpoint if \f[I]protocol\f[R] is set as \f[B]IPPROTO_TLS\f[R].
It returns a file descriptor that refers to the the SSA daemon\[cq]s
local endpoint.
Encrypted traffic will run through the daemon, be encrypted or decrypted
passively, and sent via plaintext through this channel.
.PP
The \f[B]domain\f[R] argument specifies the protocol family that will be
used for communication.
Formats currently accepted by the Secure Socket API include:
.PP
.TS
tab(@);
lw(13.6n) lw(56.4n).
T{
Domain
T}@T{
Purpose
T}
T{
\f[B]AF_INET\f[R]
T}@T{
IPv4 Internet protocols
T}
T{
\f[B]AF_INET6\f[R]
T}@T{
IPv6 Internet protocols
T}
T{
\f[B]AF_HOSTNAME\f[R]
T}@T{
Internal hostname resolution; supports IPv4 and IPv6 addresses
T}
.TE
.PP
Only TCP\-oriented connections are currently supported by the SSA, so
\f[B]type\f[R] must be set to \f[B]SOCK_STREAM\f[R].
It may optionally also include a bitwise OR of any of the following
values to modify the behavior of \f[B]socket()\f[R]:
.PP
.TS
tab(@);
lw(15.5n) lw(54.5n).
T{
Type
T}@T{
Description
T}
T{
\f[B]SOCK_NONBLOCK\f[R]
T}@T{
Set the O_NONBLOCK file status flag on the open file description (see
open(2)) referred to by the new file descriptor.
Using this flag saves extra calls to fcntl(2) to achieve the same
result.
T}
T{
\f[B]SOCK_CLOEXEC\f[R]
T}@T{
Set the close\-on\-exec (FD_CLOEXEC) flag on the new file descriptor.
See the description of the O_CLOEXEC flag in open(2) for reasons why
this may be useful.
T}
.TE
.SH RETURN VALUE
.PP
On success, a file descriptor for the new socket is returned.
On error, \-1 is returned, and errno is set appropriately.
.SH ERRORS
.PP
The following errors are specific to sockets created using IPPROTO_TLS:
.PP
.TS
tab(@);
lw(11.8n) lw(58.2n).
T{
Errno Code
T}@T{
Description
T}
T{
\f[B]ECANCELED\f[R]
T}@T{
The given operation was not able to be completed by the SSA daemon.
Look into the logs of the SSA daemon for more information.
T}
T{
other errors
T}@T{
Consult the POSIX man page for \f[B]socket()\f[R].
The error returned may apply to either the socket created by the daemon
or the socket created within the application\[en]if the error is
internal to the daemon\[cq]s socket then a log message will be reported.
T}
.TE
.SH NOTES
.PP
TODO: Add information about the AF_HOSTNAME sockaddr struct and whatnot
